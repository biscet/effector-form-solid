"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("effector"),r=require("effector-solid");const t={store:function({init:r,domain:t,existing:i},o){return i||(t?t.createStore(r,o):e.createStore(r,o))},event:function({domain:r,existing:t}){return t||(r?r.createEvent():e.createEvent())}};function i(r,i,o){var s,n,l,u,a,d,c,m,v,f,h,p;const $="function"==typeof i.init?i.init():i.init,g=t.store({domain:o,existing:null===(s=i.units)||void 0===s?void 0:s.$value,init:$},{sid:`${r}-$value`}),x=t.store({domain:o,existing:null===(n=i.units)||void 0===n?void 0:n.$errors,init:[]},{sid:`${r}-$errors`}),V=x.map((e=>e[0]?e[0]:null)),b=t.store({domain:o,existing:null===(l=i.units)||void 0===l?void 0:l.$initValue,init:$},{sid:`${r}-$initValue`}),E=t.store({domain:o,existing:null===(u=i.units)||void 0===u?void 0:u.$isTouched,init:!1},{sid:`${r}-$touched`}),y=e.combine(g,b,((e,r)=>e!==r)),T=t.event({domain:o,existing:null===(a=i.units)||void 0===a?void 0:a.onChange}),S=t.event({domain:o,existing:null===(d=i.units)||void 0===d?void 0:d.onBlur}),F=t.event({domain:o,existing:null===(c=i.units)||void 0===c?void 0:c.changed}),O=t.event({domain:o,existing:null===(m=i.units)||void 0===m?void 0:m.addError}),k=t.event({domain:o,existing:null===(v=i.units)||void 0===v?void 0:v.validate}),w=t.event({domain:o,existing:null===(f=i.units)||void 0===f?void 0:f.resetErrors}),D=t.event({domain:o,existing:null===(h=i.units)||void 0===h?void 0:h.resetValue}),P=t.event({domain:o,existing:null===(p=i.units)||void 0===p?void 0:p.reset}),B=V.map((e=>null===e)),C=V.map((e=>(null==e?void 0:e.errorText)||"")),I=e.combine({value:g,errors:x,firstError:V,isValid:B,isDirty:y,isTouched:E}),j={value:g,initValue:b,isValid:B,isDirty:y,touched:E,errors:x,firstError:V,errorText:C,onChange:T,onBlur:S,addError:O,validate:k,reset:P,resetErrors:w,resetValue:D};return{changed:F,name:r,$initValue:b,$value:g,$errors:x,$firstError:V,$errorText:C,$isValid:B,$isDirty:y,$isTouched:E,$touched:E,$field:I,onChange:T,onBlur:S,addError:O,validate:k,set:T,reset:P,resetErrors:w,resetValue:D,filter:i.filter,"@@unitShape":()=>j}}function o(r){const{form:t,field:i,fieldConfig:o}=r,s=o.rules||[],n=t.validateOn||["submit"],l=o.validateOn||[],{$value:u,$errors:a,onBlur:d,changed:c,addError:m,validate:v,resetErrors:f,resetValue:h,reset:p}=i,$="function"==typeof s?e.createStore([],{sid:`${i.name}-$rulesSources`}):e.combine(s.map((({source:r},t)=>{const o=`${i.name}-$rulesSources-${t}`;return r||e.createStore(null,{sid:o})}))),g=(x=s,(e,r,t)=>{const i=[],o="function"==typeof x?x(e,r):x;for(const[s,n]of o.entries()){const o=t?t[s]:null,l=n.validator(e,r,o);"boolean"!=typeof l||l||i.push({rule:n.name,errorText:n.errorText,value:e}),"object"!=typeof l||l.isValid||i.push({rule:n.name,errorText:l.errorText,value:e})}return i});var x;const V=new Set([...n,...l]),b=[];if(V.has("submit")){const r=e.sample({source:e.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:t.submit});b.push(r)}V.has("blur")&&b.push(e.sample({source:e.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:d})),V.has("change")&&b.push(e.sample({source:e.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:e.merge([c,h,t.resetValues])})),b.push(e.sample({source:e.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:v})),b.push(e.sample({source:e.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:t.validate}));const E=e.sample({source:u,clock:m,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})}),y=e.sample({source:u,clock:t.addErrors,fn:(e,r)=>({value:e,newErrors:r})});a.on(b,((e,{form:r,fieldValue:t,rulesSources:i})=>g(t,r,i))).on(E,((e,r)=>[r,...e])).on(y,((e,{value:r,newErrors:t})=>{const o=[];for(const e of t)e.field===i.name&&o.push({value:r,rule:e.rule,errorText:e.errorText});return[...o,...e]})).reset(f,t.reset,p,t.resetErrors),V.has("change")||a.reset(c)}function s({field:r,form:t}){const{$value:i,$initValue:o,$touched:s,onChange:n,changed:l,name:u,reset:a,resetValue:d,filter:c}=r,{setForm:m,setInitialForm:v,resetForm:f,resetTouched:h,resetValues:p}=t,$=e.sample({source:o,clock:e.merge([a,d,p,f])});s.on(l,(()=>!0)).reset(a,f,h),c?e.sample({source:n,filter:c,target:l}):e.sample({source:n,filter:()=>!0,target:l}),o.on(v,((e,r)=>r.hasOwnProperty(u)?r[u]:e)),i.on(l,((e,r)=>r)).on([m,v],((e,r)=>r.hasOwnProperty(u)?r[u]:e)).on($,((e,r)=>r))}exports.createForm=function(r){const{filter:n,domain:l,fields:u,validateOn:a,units:d}=r,c={},m=[],v=[];for(const e in u){if(!u.hasOwnProperty(e))continue;const r=i(e,u[e],l);c[e]=r,m.push(r.$isDirty),v.push(r.$touched)}const f=function(r){const t={};for(const e in r)r.hasOwnProperty(e)&&(t[e]=r[e].$value);return e.combine(t)}(c),h=function(r){const t=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:i}=r[e];t.push(i)}return e.combine(t).map((e=>e.every((e=>null===e))))}(c),p=n?e.combine(h,n,((e,r)=>e&&r)):h,$=e.combine(m).map((e=>e.some(Boolean))),g=e.combine(v).map((e=>e.some(Boolean))),x=e.combine({isValid:h,isDirty:$,touched:g}),V=t.event({domain:l,existing:null==d?void 0:d.validate}),b=t.event({domain:l,existing:null==d?void 0:d.submit}),E=t.event({domain:l,existing:null==d?void 0:d.formValidated}),y=t.event({domain:l,existing:null==d?void 0:d.setInitialForm}),T=t.event({domain:l,existing:null==d?void 0:d.setForm}),S=t.event({domain:l,existing:null==d?void 0:d.addErrors}),F=t.event({domain:l,existing:null==d?void 0:d.reset}),O=t.event({domain:l,existing:null==d?void 0:d.resetValues}),k=t.event({domain:l,existing:null==d?void 0:d.resetErrors}),w=t.event({domain:l,existing:null==d?void 0:d.resetTouched}),D=e.sample({source:f,clock:b}),P=e.sample({source:f,clock:V});for(const e in c){if(!c.hasOwnProperty(e))continue;const r=u[e],t=c[e];s({form:{setForm:T,setInitialForm:y,resetForm:F,resetTouched:w,resetValues:O},field:t}),o({form:{$values:f,submit:b,reset:F,addErrors:S,resetValues:O,resetErrors:k,validate:V,validateOn:a},fieldConfig:r,field:t})}e.sample({source:D,filter:p,target:E}),e.sample({source:P,filter:p,target:E});const B={isValid:h,isDirty:$,touched:g,submit:b,reset:F,addErrors:S,validate:V,setForm:T,setInitialForm:y,resetTouched:w,resetValues:O,resetErrors:k,formValidated:E};return{fields:c,$values:f,$eachValid:h,$isValid:h,$isDirty:$,$touched:g,$meta:x,submit:b,validate:V,resetTouched:w,addErrors:S,reset:F,resetValues:O,resetErrors:k,setForm:T,setInitialForm:y,set:T,formValidated:E,"@@unitShape":()=>B}},exports.useForm=(e,t)=>{const i=r.useUnit(e),o=r.useUnit(e.$values);let s={};var n;n=t,[Object,Array].includes((n||{}).constructor)&&0===Object.entries(n||{}).length||t.forEach((t=>{s={...s,[t]:r.useUnit(e.fields[t])}}));return{...i,fields:e.fields,sumbit:e=>{e.preventDefault(),i.submit()},values:o,signalValues:s}};
//# sourceMappingURL=effector-form-solid.cjs.js.map
