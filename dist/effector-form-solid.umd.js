!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("effector"),require("effector-solid")):"function"==typeof define&&define.amd?define(["exports","effector","effector-solid"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).EffectorFormForSolid={},e.effector,e.effectorSolid)}(this,(function(e,r,t){"use strict";const o={store:function({init:e,domain:t,existing:o},i){return o||(t?t.createStore(e,i):r.createStore(e,i))},event:function({domain:e,existing:t}){return t||(e?e.createEvent():r.createEvent())}};function i(e,t,i){var n,s,l,u,a,d,c,m,f,v,h,p;const $="function"==typeof t.init?t.init():t.init,g=o.store({domain:i,existing:null===(n=t.units)||void 0===n?void 0:n.$value,init:$},{sid:`${e}-$value`}),x=o.store({domain:i,existing:null===(s=t.units)||void 0===s?void 0:s.$errors,init:[]},{sid:`${e}-$errors`}),V=x.map((e=>e[0]?e[0]:null)),b=o.store({domain:i,existing:null===(l=t.units)||void 0===l?void 0:l.$initValue,init:$},{sid:`${e}-$initValue`}),E=o.store({domain:i,existing:null===(u=t.units)||void 0===u?void 0:u.$isTouched,init:!1},{sid:`${e}-$touched`}),y=r.combine(g,b,((e,r)=>e!==r)),T=o.event({domain:i,existing:null===(a=t.units)||void 0===a?void 0:a.onChange}),S=o.event({domain:i,existing:null===(d=t.units)||void 0===d?void 0:d.onBlur}),F=o.event({domain:i,existing:null===(c=t.units)||void 0===c?void 0:c.changed}),O=o.event({domain:i,existing:null===(m=t.units)||void 0===m?void 0:m.addError}),k=o.event({domain:i,existing:null===(f=t.units)||void 0===f?void 0:f.validate}),w=o.event({domain:i,existing:null===(v=t.units)||void 0===v?void 0:v.resetErrors}),D=o.event({domain:i,existing:null===(h=t.units)||void 0===h?void 0:h.resetValue}),P=o.event({domain:i,existing:null===(p=t.units)||void 0===p?void 0:p.reset}),j=V.map((e=>null===e)),B=V.map((e=>(null==e?void 0:e.errorText)||"")),C=r.combine({value:g,errors:x,firstError:V,isValid:j,isDirty:y,isTouched:E}),I={value:g,initValue:b,isValid:j,isDirty:y,touched:E,errors:x,firstError:V,errorText:B,onChange:T,onBlur:S,addError:O,validate:k,reset:P,resetErrors:w,resetValue:D};return{changed:F,name:e,$initValue:b,$value:g,$errors:x,$firstError:V,$errorText:B,$isValid:j,$isDirty:y,$isTouched:E,$touched:E,$field:C,onChange:T,onBlur:S,addError:O,validate:k,set:T,reset:P,resetErrors:w,resetValue:D,filter:t.filter,"@@unitShape":()=>I}}function n(e){const{form:t,field:o,fieldConfig:i}=e,n=i.rules||[],s=t.validateOn||["submit"],l=i.validateOn||[],{$value:u,$errors:a,onBlur:d,changed:c,addError:m,validate:f,resetErrors:v,resetValue:h,reset:p}=o,$="function"==typeof n?r.createStore([],{sid:`${o.name}-$rulesSources`}):r.combine(n.map((({source:e},t)=>{const i=`${o.name}-$rulesSources-${t}`;return e||r.createStore(null,{sid:i})}))),g=function(e){return(r,t,o)=>{const i=[],n="function"==typeof e?e(r,t):e;for(const[e,s]of n.entries()){const n=o?o[e]:null,l=s.validator(r,t,n);"boolean"!=typeof l||l||i.push({rule:s.name,errorText:s.errorText,value:r}),"object"!=typeof l||l.isValid||i.push({rule:s.name,errorText:l.errorText,value:r})}return i}}(n),x=new Set([...s,...l]),V=[];if(x.has("submit")){const e=r.sample({source:r.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:t.submit});V.push(e)}x.has("blur")&&V.push(r.sample({source:r.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:d})),x.has("change")&&V.push(r.sample({source:r.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:r.merge([c,h,t.resetValues])})),V.push(r.sample({source:r.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:f})),V.push(r.sample({source:r.combine({fieldValue:u,form:t.$values,rulesSources:$}),clock:t.validate}));const b=r.sample({source:u,clock:m,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})}),E=r.sample({source:u,clock:t.addErrors,fn:(e,r)=>({value:e,newErrors:r})});a.on(V,((e,{form:r,fieldValue:t,rulesSources:o})=>g(t,r,o))).on(b,((e,r)=>[r,...e])).on(E,((e,{value:r,newErrors:t})=>{const i=[];for(const e of t)e.field===o.name&&i.push({value:r,rule:e.rule,errorText:e.errorText});return[...i,...e]})).reset(v,t.reset,p,t.resetErrors),x.has("change")||a.reset(c)}function s({field:e,form:t}){const{$value:o,$initValue:i,$touched:n,onChange:s,changed:l,name:u,reset:a,resetValue:d,filter:c}=e,{setForm:m,setInitialForm:f,resetForm:v,resetTouched:h,resetValues:p}=t,$=r.sample({source:i,clock:r.merge([a,d,p,v])});n.on(l,(()=>!0)).reset(a,v,h),c?r.sample({source:s,filter:c,target:l}):r.sample({source:s,filter:()=>!0,target:l}),i.on(f,((e,r)=>r.hasOwnProperty(u)?r[u]:e)),o.on(l,((e,r)=>r)).on([m,f],((e,r)=>r.hasOwnProperty(u)?r[u]:e)).on($,((e,r)=>r))}const l=(e,r)=>{const o=Object.keys(e.fields);let i={};return(e=>[Object,Array].includes((e||{}).constructor)&&0===Object.entries(e||{}).length)(r)?o.forEach((r=>{i={...i,[r]:t.useUnit(e.fields[r])}})):r.forEach((r=>{i={...i,[r]:t.useUnit(e.fields[r])}})),i};e.createForm=function(e){const{filter:t,domain:l,fields:u,validateOn:a,units:d}=e,c={},m=[],f=[];for(const e in u){if(!u.hasOwnProperty(e))continue;const r=i(e,u[e],l);c[e]=r,m.push(r.$isDirty),f.push(r.$touched)}const v=function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r].$value);return r.combine(t)}(c),h=function(e){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:o}=e[r];t.push(o)}return r.combine(t).map((e=>e.every((e=>null===e))))}(c),p=t?r.combine(h,t,((e,r)=>e&&r)):h,$=r.combine(m).map((e=>e.some(Boolean))),g=r.combine(f).map((e=>e.some(Boolean))),x=r.combine({isValid:h,isDirty:$,touched:g}),V=o.event({domain:l,existing:null==d?void 0:d.validate}),b=o.event({domain:l,existing:null==d?void 0:d.submit}),E=o.event({domain:l,existing:null==d?void 0:d.formValidated}),y=o.event({domain:l,existing:null==d?void 0:d.setInitialForm}),T=o.event({domain:l,existing:null==d?void 0:d.setForm}),S=o.event({domain:l,existing:null==d?void 0:d.addErrors}),F=o.event({domain:l,existing:null==d?void 0:d.reset}),O=o.event({domain:l,existing:null==d?void 0:d.resetValues}),k=o.event({domain:l,existing:null==d?void 0:d.resetErrors}),w=o.event({domain:l,existing:null==d?void 0:d.resetTouched}),D=r.sample({source:v,clock:b}),P=r.sample({source:v,clock:V});for(const e in c){if(!c.hasOwnProperty(e))continue;const r=u[e],t=c[e];s({form:{setForm:T,setInitialForm:y,resetForm:F,resetTouched:w,resetValues:O},field:t}),n({form:{$values:v,submit:b,reset:F,addErrors:S,resetValues:O,resetErrors:k,validate:V,validateOn:a},fieldConfig:r,field:t})}r.sample({source:D,filter:p,target:E}),r.sample({source:P,filter:p,target:E});const j={isValid:h,isDirty:$,touched:g,submit:b,reset:F,addErrors:S,validate:V,setForm:T,setInitialForm:y,resetTouched:w,resetValues:O,resetErrors:k,formValidated:E};return{fields:c,$values:v,$eachValid:h,$isValid:h,$isDirty:$,$touched:g,$meta:x,submit:b,validate:V,resetTouched:w,addErrors:S,reset:F,resetValues:O,resetErrors:k,setForm:T,setInitialForm:y,set:T,formValidated:E,"@@unitShape":()=>j}},e.useForm=(e,r)=>{const o=t.useUnit(e),i=l(e,r);return{...o,submit:e=>{e.preventDefault(),o.submit()},values:i}},e.useFormSignals=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=effector-form-solid.umd.js.map
